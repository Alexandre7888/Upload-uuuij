<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Upload Vimeo</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { color: #1ab7ea; }
    video { display: block; margin-bottom: 10px; max-width: 100%; }
    .video-container { border: 1px solid #ccc; padding: 10px; margin-bottom: 20px; }
    button { margin-top: 5px; cursor: pointer; }
    a { color: #1ab7ea; text-decoration: none; }
    a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <h1>Upload de vídeo para Vimeo</h1>

  <!-- Botão de autorização -->
  <a id="authorize" href="#">Autorizar Vimeo</a>
  <p id="status"></p>

  <!-- Input para selecionar vídeo -->
  <input type="file" id="videoFile" accept="video/*">
  <button id="uploadBtn">Enviar vídeo</button>

  <h2>Vídeos enviados:</h2>
  <div id="videoList"></div>

  <script>
    /********** CONFIGURAÇÃO DO VIMEO **********/
    const clientId = "05a788a3aea49a1d542bd4eedc497b6deab64490";
    const redirectUri = "https://alexandre7888.github.io/Upload-uuuij/rede.html"; // URL registrada no Vimeo
    const scope = "public+private+video_files+interact";

    // Monta URL de autorização
    const authUrl = `https://api.vimeo.com/oauth/authorize?response_type=code&client_id=${clientId}&redirect_uri=${encodeURIComponent(redirectUri)}&scope=${scope}`;
    document.getElementById("authorize").href = authUrl;

    // Captura código de autorização
    const params = new URLSearchParams(window.location.search);
    const code = params.get("code");

    if (code) {
      document.getElementById("status").innerText = "Autorizado! Código: " + code;
      // Envie este código para seu servidor para gerar o Access Token
    }

    /********** FUNÇÃO DE UPLOAD **********/
    const uploadBtn = document.getElementById("uploadBtn");
    const videoList = document.getElementById("videoList");

    uploadBtn.addEventListener("click", async () => {
      const file = document.getElementById("videoFile").files[0];
      if (!file) return alert("Selecione um vídeo");

      // Aqui você deve usar o Access Token gerado pelo servidor
      const accessToken = "2edac88b41f0269f93c12a223414ed20"; // Para teste
      if (!accessToken) return alert("Defina o access token obtido do servidor");

      const uploadUrl = "https://api.vimeo.com/me/videos";
      const formData = new FormData();
      formData.append("file_data", file);

      try {
        const res = await fetch(uploadUrl, {
          method: "POST",
          headers: {
            "Authorization": `Bearer ${accessToken}`
          },
          body: formData
        });

        const data = await res.json();
        console.log(data);

        if (data.link) {
          addVideoToList(data.link);
        } else {
          alert("Upload concluído, mas não foi possível obter o link.");
        }

      } catch (err) {
        console.error(err);
        alert("Erro no upload: " + err.message);
      }
    });

    /********** FUNÇÃO PARA ADICIONAR VÍDEO NA LISTA **********/
    function addVideoToList(link) {
      const container = document.createElement("div");
      container.className = "video-container";

      container.innerHTML = `
        <a href="${link}" target="_blank">${link}</a><br>
        <button onclick="copyLink(this)">Copiar link</button>
      `;

      videoList.appendChild(container);
    }

    /********** FUNÇÃO PARA COPIAR LINK **********/
    function copyLink(button) {
      const link = button.previousElementSibling.href;
      navigator.clipboard.writeText(link)
        .then(() => alert("Link copiado!"))
        .catch(err => alert("Erro ao copiar link: " + err));
    }
  </script>
</body>
</html>